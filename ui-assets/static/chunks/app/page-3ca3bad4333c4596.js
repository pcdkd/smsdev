(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7300:function(e,t,s){Promise.resolve().then(s.bind(s,6591))},6591:function(e,t,s){"use strict";s.d(t,{default:function(){return d}});var r=s(7437),n=s(2265),o=s(1816);function a(e){let{conversations:t,activeConversation:s,onSelectConversation:o}=e,[a,l]=(0,n.useState)(""),[d,c]=(0,n.useState)("all"),i=(0,n.useMemo)(()=>{let e=t;if(a.trim()){let t=a.toLowerCase();e=e.filter(e=>!!e.phoneNumber.toLowerCase().includes(t)||e.messages.some(e=>e.body.toLowerCase().includes(t)))}return"all"!==d&&(e=e.filter(e=>{if("unread"===d)return e.unreadCount>0;if("recent"===d){let t=new Date;return t.setDate(t.getDate()-1),new Date(e.lastActivity)>t}return!0})),e},[t,a,d]),u=()=>{l(""),c("all")};return 0===t.length?(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-muted rounded-full flex items-center justify-center mx-auto mb-3",children:(0,r.jsx)("span",{className:"text-lg",children:"\uD83D\uDCED"})}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"No conversations yet"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Send a message via API to start"})]})}):(0,r.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,r.jsxs)("div",{className:"p-3 border-b border-border space-y-3",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:(0,r.jsx)("svg",{className:"h-4 w-4 text-muted-foreground",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})}),(0,r.jsx)("input",{type:"text",value:a,onChange:e=>l(e.target.value),placeholder:"Search conversations...",className:"w-full pl-10 pr-8 py-2 text-sm bg-background border border-input rounded-md text-foreground placeholder:text-muted-foreground focus-ring"}),a&&(0,r.jsx)("button",{onClick:u,className:"absolute inset-y-0 right-0 flex items-center pr-3 text-muted-foreground hover:text-foreground",children:(0,r.jsx)("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsx)("div",{className:"flex space-x-1",children:[{key:"all",label:"All",count:t.length},{key:"unread",label:"Unread",count:t.filter(e=>e.unreadCount>0).length},{key:"recent",label:"Recent",count:t.filter(e=>{let t=new Date;return t.setDate(t.getDate()-1),new Date(e.lastActivity)>t}).length}].map(e=>(0,r.jsxs)("button",{onClick:()=>c(e.key),className:"px-2 py-1 text-xs rounded-md transition-colors ".concat(d===e.key?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:[e.label,e.count>0&&(0,r.jsxs)("span",{className:"ml-1 opacity-70",children:["(",e.count,")"]})]},e.key))}),(a||"all"!==d)&&(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[(0,r.jsxs)("span",{children:[i.length," of ",t.length," conversations"]}),(a||"all"!==d)&&(0,r.jsx)("button",{onClick:u,className:"text-primary hover:text-primary/80 font-medium",children:"Clear filters"})]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===i.length?(0,r.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-muted rounded-full flex items-center justify-center mx-auto mb-2",children:(0,r.jsx)("svg",{className:"h-5 w-5 text-muted-foreground",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"No matching conversations"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Try adjusting your search or filters"})]})}):i.map(e=>{var t,n;let l=s===e.phoneNumber,d=e.messages&&e.messages.length>0?e.messages[e.messages.length-1]:null,c=e.unreadCount>0,i=(e,t)=>{if(!t.trim())return e;let s=RegExp("(".concat(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),")"),"gi");return e.replace(s,'<mark class="bg-yellow-200 dark:bg-yellow-900/50 px-0.5 rounded">$1</mark>')};return(0,r.jsx)("div",{onClick:()=>o(e.phoneNumber),className:"p-4 border-b border-border cursor-pointer transition-colors hover:bg-accent/50 ".concat(l?"bg-accent border-l-2 border-l-primary":""),children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("h4",{className:"text-sm font-medium truncate ".concat("text-foreground"),dangerouslySetInnerHTML:{__html:i(e.phoneNumber,a)}}),c&&(0,r.jsx)("div",{className:"w-2 h-2 bg-primary rounded-full flex-shrink-0"})]}),d&&(0,r.jsx)("div",{className:"text-xs mt-1 truncate ".concat("text-muted-foreground"),dangerouslySetInnerHTML:{__html:i(d.body,a)}}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:function(e){let t=new Date(e),s=Math.floor((new Date().getTime()-t.getTime())/6e4),r=Math.floor(s/60),n=Math.floor(r/24);return s<1?"Just now":s<60?"".concat(s,"m ago"):r<24?"".concat(r,"h ago"):n<7?"".concat(n,"d ago"):t.toLocaleDateString()}(e.lastActivity)}),(0,r.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-muted-foreground",children:[(0,r.jsxs)("span",{children:[(null===(t=e.messages)||void 0===t?void 0:t.length)||0," msg",1!==((null===(n=e.messages)||void 0===n?void 0:n.length)||0)?"s":""]}),d&&(0,r.jsx)("div",{className:"w-1.5 h-1.5 rounded-full ".concat("delivered"===d.status?"bg-green-500":"sent"===d.status?"bg-blue-500":"failed"===d.status?"bg-red-500":"bg-muted-foreground")})]})]})]}),c&&(0,r.jsx)("div",{className:"bg-primary text-primary-foreground text-xs rounded-full w-5 h-5 flex items-center justify-center flex-shrink-0 ml-2",children:e.unreadCount})]})},e.phoneNumber)})})]})}function l(e){let{conversation:t,onSendReply:s}=e,[o,a]=(0,n.useState)(""),[l,d]=(0,n.useState)(""),[c,i]=(0,n.useState)(!1),u=(0,n.useRef)(null),m=(0,n.useMemo)(()=>{if(!l.trim())return t.messages;let e=l.toLowerCase();return t.messages.filter(t=>t.body.toLowerCase().includes(e))},[t.messages,l]);(0,n.useEffect)(()=>{if(!l.trim()){var e;null===(e=u.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}},[t.messages,l]);let x=e=>e.from===t.phoneNumber,h=(e,t)=>{if(!t.trim())return e;let s=RegExp("(".concat(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),")"),"gi");return e.replace(s,'<mark class="bg-yellow-200 dark:bg-yellow-900/50 px-0.5 rounded">$1</mark>')};return(0,r.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,r.jsxs)("div",{className:"bg-card/50 backdrop-blur-sm border-b border-border p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:t.phoneNumber}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:l.trim()?"".concat(m.length," of ").concat(t.messages.length,' messages matching "').concat(l,'"'):"".concat(t.messages.length," message").concat(1!==t.messages.length?"s":"")})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{onClick:()=>i(!c),className:"p-2 rounded-md transition-colors ".concat(c?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground hover:bg-accent"),title:"Search messages",children:(0,r.jsx)("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[(0,r.jsx)("span",{children:"Virtual Phone"}),(0,r.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full status-indicator"})]})]})]}),c&&(0,r.jsxs)("div",{className:"mt-3 relative",children:[(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:(0,r.jsx)("svg",{className:"h-4 w-4 text-muted-foreground",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})}),(0,r.jsx)("input",{type:"text",value:l,onChange:e=>d(e.target.value),placeholder:"Search in this conversation...",className:"w-full pl-10 pr-8 py-2 text-sm bg-background border border-input rounded-md text-foreground placeholder:text-muted-foreground focus-ring",autoFocus:!0}),l&&(0,r.jsx)("button",{onClick:()=>{d(""),i(!1)},className:"absolute inset-y-0 right-0 flex items-center pr-3 text-muted-foreground hover:text-foreground",children:(0,r.jsx)("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 chat-scroll",children:[0===m.length?(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-muted rounded-full flex items-center justify-center mx-auto mb-3",children:(0,r.jsx)("svg",{className:"h-6 w-6 text-muted-foreground",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"No messages found"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Try a different search term"})]})}):m.map(e=>(0,r.jsx)("div",{className:"flex message-bubble ".concat(x(e)?"justify-end":"justify-start"),children:(0,r.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-3 rounded-lg border shadow-sm ".concat(x(e)?"bg-primary text-primary-foreground border-primary/20":"bg-card text-card-foreground border-border"),children:[(0,r.jsx)("p",{className:"text-sm leading-relaxed",dangerouslySetInnerHTML:{__html:h(e.body,l)}}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-2 space-x-2",children:[(0,r.jsx)("span",{className:"text-xs ".concat(x(e)?"text-primary-foreground/70":"text-muted-foreground"),children:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)("div",{className:"w-1.5 h-1.5 rounded-full ".concat("delivered"===e.status?"bg-green-500":"sent"===e.status?"bg-blue-500":"failed"===e.status?"bg-red-500":x(e)?"bg-primary-foreground/50":"bg-muted-foreground")}),x(e)&&(0,r.jsx)("span",{className:"text-xs ".concat(x(e)?"text-primary-foreground/70":"text-muted-foreground"),children:e.status})]})]})]})},e.id)),(0,r.jsx)("div",{ref:u})]}),(0,r.jsxs)("div",{className:"bg-card/50 backdrop-blur-sm border-t border-border p-4",children:[(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),o.trim()&&(s(t.phoneNumber,o.trim()),a(""))},className:"flex space-x-3",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)("input",{type:"text",value:o,onChange:e=>a(e.target.value),placeholder:"Reply to ".concat(t.phoneNumber,"..."),className:"w-full px-3 py-2 bg-background border border-input rounded-md text-foreground placeholder:text-muted-foreground focus-ring"})}),(0,r.jsx)("button",{type:"submit",disabled:!o.trim(),className:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 focus-ring disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:"Send"})]}),(0,r.jsxs)("div",{className:"flex items-center mt-2 text-xs text-muted-foreground",children:[(0,r.jsx)("span",{className:"mr-1",children:"\uD83D\uDCA1"}),(0,r.jsx)("span",{children:"This reply will be sent from the virtual phone back to your application"})]})]})]})}function d(){let[e,t]=(0,n.useState)(null),[s,d]=(0,n.useState)([]),[c,i]=(0,n.useState)(null),[u,m]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=(0,o.io)("http://localhost:4001");return e.on("connect",()=>{console.log("\uD83D\uDCE1 Connected to sms-dev API"),m(!0)}),e.on("disconnect",()=>{console.log("\uD83D\uDCF4 Disconnected from sms-dev API"),m(!1)}),e.on("message:new",e=>{console.log("\uD83D\uDCE8 New message received:",e),h(e)}),e.on("message:updated",e=>{console.log("\uD83D\uDCDD Message updated:",e),h(e)}),t(e),()=>{e.disconnect()}},[]),(0,n.useEffect)(()=>{u&&x()},[u]);let x=async()=>{try{let e=await fetch("".concat("http://localhost:4001","/v1/dev/conversations")),t=await e.json();d(t.conversations||[])}catch(e){console.error("Failed to load conversations:",e)}},h=e=>{d(t=>{let s=[...t],r=s.findIndex(t=>t.phoneNumber===e.to||t.phoneNumber===e.from),n=e.to.startsWith("+1555")?e.from:e.to;if(r>=0){let t=s[r];if(t){if(t.messages.some(t=>t.id===e.id)){let s=t.messages.findIndex(t=>t.id===e.id);s>=0&&(t.messages[s]=e)}else t.messages.push(e);t.lastActivity=e.created_at,t.messages.sort((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime())}}else s.push({phoneNumber:n,messages:[e],lastActivity:e.created_at,unreadCount:e.from!==n?1:0});return s.sort((e,t)=>new Date(t.lastActivity).getTime()-new Date(e.lastActivity).getTime())})},f=s.find(e=>e.phoneNumber===c);return(0,r.jsxs)("div",{className:"h-full flex bg-background",children:[(0,r.jsxs)("div",{className:"w-80 bg-card border-r border-border flex flex-col",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-border",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"Conversations"}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground mt-1 flex items-center",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat(u?"bg-green-500 status-indicator":"bg-muted-foreground")}),u?"Ready to receive messages":"Connecting..."]})]}),(0,r.jsx)(a,{conversations:s,activeConversation:c,onSelectConversation:t=>{i(t),e&&e.emit("conversation:join",{phoneNumber:t}),d(e=>e.map(e=>e.phoneNumber===t?{...e,unreadCount:0}:e))}})]}),(0,r.jsx)("div",{className:"flex-1 flex flex-col bg-background",children:f?(0,r.jsx)(l,{conversation:f,onSendReply:(t,s)=>{e&&c&&e.emit("reply:send",{to:t,from:c,body:s})}}):(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center animate-fade-in",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCAC"})}),(0,r.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"No conversation selected"}),(0,r.jsx)("p",{className:"text-muted-foreground max-w-sm",children:"Send a message via the API to start a conversation, then select it from the sidebar"}),(0,r.jsx)("div",{className:"mt-4 p-3 bg-muted/50 rounded-lg text-sm text-muted-foreground border border-dashed",children:(0,r.jsx)("code",{className:"text-xs",children:"curl -X POST http://localhost:4001/v1/messages"})})]})})})]})}}},function(e){e.O(0,[816,971,23,744],function(){return e(e.s=7300)}),_N_E=e.O()}]);